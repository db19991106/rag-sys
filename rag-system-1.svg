<svg id="my-svg" width="100%" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="max-width: 3691px; background-color: white;" viewBox="-50 -10 3691 14413.750000000002" role="graphics-document document" aria-roledescription="sequence"><rect x="40" y="12084.500000000002" fill="rgb(235, 245, 235)" width="3551" height="2223.25" class="rect"/><rect x="40" y="11258.166666666668" fill="rgb(245, 245, 245)" width="3381" height="816.3333333333339" class="rect"/><rect x="40" y="9624.416666666668" fill="rgb(240, 240, 255)" width="3381" height="1623.75" class="rect"/><rect x="40" y="8364.916666666668" fill="rgb(255, 255, 240)" width="3381" height="1249.5" class="rect"/><rect x="40" y="3210.8333333333335" fill="rgb(255, 240, 245)" width="3381" height="5144.083333333334" class="rect"/><rect x="40" y="2066.666666666667" fill="rgb(240, 255, 240)" width="3381" height="1134.1666666666665" class="rect"/><rect x="40" y="1262" fill="rgb(255, 248, 240)" width="3381" height="794.666666666667" class="rect"/><rect x="40" y="75" fill="rgb(240, 248, 255)" width="3381" height="1177" class="rect"/><g><rect x="3311" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="150" height="65" name="DocMgr" rx="3" ry="3" class="actor actor-bottom"/><text x="3386" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="3386" dy="-8">DocumentManager</tspan></text><text x="3386" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="3386" dy="8">文档管理器</tspan></text></g><g><rect x="3082" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="150" height="65" name="LLM" rx="3" ry="3" class="actor actor-bottom"/><text x="3157" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="3157" dy="-8">LLMClient</tspan></text><text x="3157" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="3157" dy="8">大模型客户端</tspan></text></g><g><rect x="2882" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="150" height="65" name="Reranker" rx="3" ry="3" class="actor actor-bottom"/><text x="2957" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2957" dy="-8">RerankerManager</tspan></text><text x="2957" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2957" dy="8">重排序器</tspan></text></g><g><rect x="2536" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="150" height="65" name="Fusion" rx="3" ry="3" class="actor actor-bottom"/><text x="2611" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2611" dy="-8">FusionEngine</tspan></text><text x="2611" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2611" dy="8">融合引擎</tspan></text></g><g><rect x="2336" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="150" height="65" name="BM25" rx="3" ry="3" class="actor actor-bottom"/><text x="2411" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2411" dy="0">BM25检索器</tspan></text></g><g><rect x="2108" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="178" height="65" name="VectorDB" rx="3" ry="3" class="actor actor-bottom"/><text x="2197" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2197" dy="-8">VectorDatabaseManager</tspan></text><text x="2197" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2197" dy="8">向量数据库</tspan></text></g><g><rect x="1908" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="150" height="65" name="EmbedSvc" rx="3" ry="3" class="actor actor-bottom"/><text x="1983" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1983" dy="-8">EmbeddingService</tspan></text><text x="1983" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1983" dy="8">嵌入服务</tspan></text></g><g><rect x="1633" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="150" height="65" name="Retriever" rx="3" ry="3" class="actor actor-bottom"/><text x="1708" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1708" dy="-8">Retriever</tspan></text><text x="1708" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1708" dy="8">检索编排器</tspan></text></g><g><rect x="1280" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="150" height="65" name="RAGGen" rx="3" ry="3" class="actor actor-bottom"/><text x="1355" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1355" dy="-8">RAGGenerator</tspan></text><text x="1355" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1355" dy="8">生成器编排</tspan></text></g><g><rect x="1004" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="150" height="65" name="CtxAnalyzer" rx="3" ry="3" class="actor actor-bottom"/><text x="1079" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1079" dy="-8">ContextAnalyzer</tspan></text><text x="1079" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1079" dy="8">上下文分析器</tspan></text></g><g><rect x="791" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="163" height="65" name="ConvMgr" rx="3" ry="3" class="actor actor-bottom"/><text x="872.5" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="872.5" dy="-8">ConversationManager</tspan></text><text x="872.5" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="872.5" dy="8">会话管理器</tspan></text></g><g><rect x="591" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="150" height="65" name="IntentRec" rx="3" ry="3" class="actor actor-bottom"/><text x="666" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="666" dy="-8">IntentRecognizer</tspan></text><text x="666" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="666" dy="8">意图识别器</tspan></text></g><g><rect x="313" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="150" height="65" name="RAGRouter" rx="3" ry="3" class="actor actor-bottom"/><text x="388" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="388" dy="-8">RAGRouter</tspan></text><text x="388" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="388" dy="8">/rag/generate</tspan></text></g><g><rect x="0" y="14327.750000000002" fill="#eaeaea" stroke="#666" width="150" height="65" name="User" rx="3" ry="3" class="actor actor-bottom"/><text x="75" y="14360.250000000002" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="75" dy="0">用户/前端</tspan></text></g><g><line id="actor13" x1="3386" y1="65" x2="3386" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="DocMgr"/><g id="root-13"><rect x="3311" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="DocMgr" rx="3" ry="3" class="actor actor-top"/><text x="3386" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="3386" dy="-8">DocumentManager</tspan></text><text x="3386" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="3386" dy="8">文档管理器</tspan></text></g></g><g><line id="actor12" x1="3157" y1="65" x2="3157" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="LLM"/><g id="root-12"><rect x="3082" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="LLM" rx="3" ry="3" class="actor actor-top"/><text x="3157" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="3157" dy="-8">LLMClient</tspan></text><text x="3157" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="3157" dy="8">大模型客户端</tspan></text></g></g><g><line id="actor11" x1="2957" y1="65" x2="2957" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Reranker"/><g id="root-11"><rect x="2882" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Reranker" rx="3" ry="3" class="actor actor-top"/><text x="2957" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2957" dy="-8">RerankerManager</tspan></text><text x="2957" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2957" dy="8">重排序器</tspan></text></g></g><g><line id="actor10" x1="2611" y1="65" x2="2611" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Fusion"/><g id="root-10"><rect x="2536" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Fusion" rx="3" ry="3" class="actor actor-top"/><text x="2611" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2611" dy="-8">FusionEngine</tspan></text><text x="2611" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2611" dy="8">融合引擎</tspan></text></g></g><g><line id="actor9" x1="2411" y1="65" x2="2411" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="BM25"/><g id="root-9"><rect x="2336" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="BM25" rx="3" ry="3" class="actor actor-top"/><text x="2411" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2411" dy="0">BM25检索器</tspan></text></g></g><g><line id="actor8" x1="2197" y1="65" x2="2197" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="VectorDB"/><g id="root-8"><rect x="2108" y="0" fill="#eaeaea" stroke="#666" width="178" height="65" name="VectorDB" rx="3" ry="3" class="actor actor-top"/><text x="2197" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2197" dy="-8">VectorDatabaseManager</tspan></text><text x="2197" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="2197" dy="8">向量数据库</tspan></text></g></g><g><line id="actor7" x1="1983" y1="65" x2="1983" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="EmbedSvc"/><g id="root-7"><rect x="1908" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="EmbedSvc" rx="3" ry="3" class="actor actor-top"/><text x="1983" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1983" dy="-8">EmbeddingService</tspan></text><text x="1983" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1983" dy="8">嵌入服务</tspan></text></g></g><g><line id="actor6" x1="1708" y1="65" x2="1708" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="Retriever"/><g id="root-6"><rect x="1633" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="Retriever" rx="3" ry="3" class="actor actor-top"/><text x="1708" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1708" dy="-8">Retriever</tspan></text><text x="1708" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1708" dy="8">检索编排器</tspan></text></g></g><g><line id="actor5" x1="1355" y1="65" x2="1355" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="RAGGen"/><g id="root-5"><rect x="1280" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="RAGGen" rx="3" ry="3" class="actor actor-top"/><text x="1355" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1355" dy="-8">RAGGenerator</tspan></text><text x="1355" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1355" dy="8">生成器编排</tspan></text></g></g><g><line id="actor4" x1="1079" y1="65" x2="1079" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="CtxAnalyzer"/><g id="root-4"><rect x="1004" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="CtxAnalyzer" rx="3" ry="3" class="actor actor-top"/><text x="1079" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1079" dy="-8">ContextAnalyzer</tspan></text><text x="1079" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="1079" dy="8">上下文分析器</tspan></text></g></g><g><line id="actor3" x1="872.5" y1="65" x2="872.5" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="ConvMgr"/><g id="root-3"><rect x="791" y="0" fill="#eaeaea" stroke="#666" width="163" height="65" name="ConvMgr" rx="3" ry="3" class="actor actor-top"/><text x="872.5" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="872.5" dy="-8">ConversationManager</tspan></text><text x="872.5" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="872.5" dy="8">会话管理器</tspan></text></g></g><g><line id="actor2" x1="666" y1="65" x2="666" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="IntentRec"/><g id="root-2"><rect x="591" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="IntentRec" rx="3" ry="3" class="actor actor-top"/><text x="666" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="666" dy="-8">IntentRecognizer</tspan></text><text x="666" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="666" dy="8">意图识别器</tspan></text></g></g><g><line id="actor1" x1="388" y1="65" x2="388" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="RAGRouter"/><g id="root-1"><rect x="313" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="RAGRouter" rx="3" ry="3" class="actor actor-top"/><text x="388" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="388" dy="-8">RAGRouter</tspan></text><text x="388" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="388" dy="8">/rag/generate</tspan></text></g></g><g><line id="actor0" x1="75" y1="65" x2="75" y2="14327.750000000002" class="actor-line 200" stroke-width="0.5px" stroke="#999" name="User"/><g id="root-0"><rect x="0" y="0" fill="#eaeaea" stroke="#666" width="150" height="65" name="User" rx="3" ry="3" class="actor actor-top"/><text x="75" y="32.5" dominant-baseline="central" alignment-baseline="central" class="actor actor-box" style="text-anchor: middle; font-size: 16px; font-weight: 400;"><tspan x="75" dy="0">用户/前端</tspan></text></g></g><style>#my-svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#my-svg .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#my-svg .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#my-svg .error-icon{fill:#552222;}#my-svg .error-text{fill:#552222;stroke:#552222;}#my-svg .edge-thickness-normal{stroke-width:1px;}#my-svg .edge-thickness-thick{stroke-width:3.5px;}#my-svg .edge-pattern-solid{stroke-dasharray:0;}#my-svg .edge-thickness-invisible{stroke-width:0;fill:none;}#my-svg .edge-pattern-dashed{stroke-dasharray:3;}#my-svg .edge-pattern-dotted{stroke-dasharray:2;}#my-svg .marker{fill:#333333;stroke:#333333;}#my-svg .marker.cross{stroke:#333333;}#my-svg svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#my-svg p{margin:0;}#my-svg .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#my-svg text.actor&gt;tspan{fill:black;stroke:none;}#my-svg .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#my-svg .innerArc{stroke-width:1.5;stroke-dasharray:none;}#my-svg .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#my-svg .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#my-svg #arrowhead path{fill:#333;stroke:#333;}#my-svg .sequenceNumber{fill:white;}#my-svg #sequencenumber{fill:#333;}#my-svg #crosshead path{fill:#333;stroke:#333;}#my-svg .messageText{fill:#333;stroke:none;}#my-svg .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#my-svg .labelText,#my-svg .labelText&gt;tspan{fill:black;stroke:none;}#my-svg .loopText,#my-svg .loopText&gt;tspan{fill:black;stroke:none;}#my-svg .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#my-svg .note{stroke:#aaaa33;fill:#fff5ad;}#my-svg .noteText,#my-svg .noteText&gt;tspan{fill:black;stroke:none;}#my-svg .activation0{fill:#f4f4f4;stroke:#666;}#my-svg .activation1{fill:#f4f4f4;stroke:#666;}#my-svg .activation2{fill:#f4f4f4;stroke:#666;}#my-svg .actorPopupMenu{position:absolute;}#my-svg .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#my-svg .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#my-svg .actor-man circle,#my-svg line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#my-svg :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style><g/><defs><symbol id="computer" width="24" height="24"><path transform="scale(.5)" d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z"/></symbol></defs><defs><symbol id="database" fill-rule="evenodd" clip-rule="evenodd"><path transform="scale(.5)" d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z"/></symbol></defs><defs><symbol id="clock" width="24" height="24"><path transform="scale(.5)" d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z"/></symbol></defs><defs><marker id="arrowhead" refX="7.9" refY="5" markerUnits="userSpaceOnUse" markerWidth="12" markerHeight="12" orient="auto-start-reverse"><path d="M -1 0 L 10 5 L 0 10 z"/></marker></defs><defs><marker id="crosshead" markerWidth="15" markerHeight="8" orient="auto" refX="4" refY="4.5"><path fill="none" stroke="#000000" stroke-width="1pt" d="M 1,2 L 6,7 M 6,2 L 1,7" style="stroke-dasharray: 0, 0;"/></marker></defs><defs><marker id="filled-head" refX="15.5" refY="7" markerWidth="20" markerHeight="28" orient="auto"><path d="M 18,7 L9,13 L14,7 L9,1 Z"/></marker></defs><defs><marker id="sequencenumber" refX="15" refY="15" markerWidth="60" markerHeight="40" orient="auto"><circle cx="15" cy="15" r="6"/></marker></defs><g><rect x="50" y="95" fill="#EDF2AE" stroke="#666" width="3361" height="37" class="note"/><text x="1731" y="100" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1731">【阶段1】请求接收与意图识别</tspan></text></g><g><rect x="383" y="214" fill="#EDF2AE" stroke="#666" width="10" height="11850.500000000002" class="activation0"/></g><g><rect x="661" y="262" fill="#EDF2AE" stroke="#666" width="10" height="688.5" class="activation0"/></g><g><rect x="691" y="362.5" fill="#EDF2AE" stroke="#666" width="150" height="139" class="note"/><text x="766" y="368" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="766">匹配模式：</tspan></text><text x="766" y="385" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="766">• 问候语识别</tspan></text><text x="766" y="402" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="766">• 总结类关键词</tspan></text><text x="766" y="419" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="766">• 对比类关键词</tspan></text><text x="766" y="436" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="766">• 流程/步骤类</tspan></text><text x="766" y="453" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="766">• 定义类</tspan></text><text x="766" y="470" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="766">• 搜索类</tspan></text></g><g><line x1="586" y1="511.5" x2="3168" y2="511.5" class="loopLine"/><line x1="3168" y1="511.5" x2="3168" y2="904.5" class="loopLine"/><line x1="586" y1="904.5" x2="3168" y2="904.5" class="loopLine"/><line x1="586" y1="511.5" x2="586" y2="904.5" class="loopLine"/><line x1="586" y1="635.5" x2="3168" y2="635.5" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="586,511.5 636,511.5 636,524.5 627.6,531.5 586,531.5" class="labelBox"/><text x="611" y="524" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="1902" y="529" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="1902">[规则识别置信度≥0.9]</tspan></text><text x="1877" y="653" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[置信度&lt;0.9且LLM可用]</text></g><g><rect x="534.5" y="960.5" fill="#EDF2AE" stroke="#666" width="263" height="88" class="note"/><text x="666" y="966" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="666">IntentType枚举：</tspan></text><text x="666" y="983" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="666">QUESTION, SEARCH, SUMMARY,</tspan></text><text x="666" y="1000" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="666">COMPARISON, PROCEDURE,</tspan></text><text x="666" y="1017" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="666">DEFINITION, GREETING, OTHER</tspan></text></g><g><rect x="413" y="1151" fill="#EDF2AE" stroke="#666" width="187" height="91" class="note"/><text x="507" y="1156" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="507">动态参数：</tspan></text><text x="507" y="1173" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="507">• top_k: 3-15(按意图)</tspan></text><text x="507" y="1191" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="507">• similarity_threshold: 0.4</tspan></text><text x="507" y="1209" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="507">• prompt_template调整</tspan></text></g><g><rect x="50" y="1282" fill="#EDF2AE" stroke="#666" width="3361" height="37" class="note"/><text x="1731" y="1287" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1731">【阶段2】会话管理与上下文加载</tspan></text></g><g><rect x="1350" y="1367" fill="#EDF2AE" stroke="#666" width="10" height="10636.500000000002" class="activation0"/></g><g><rect x="867.5" y="1458" fill="#EDF2AE" stroke="#666" width="10" height="578.6666666666667" class="activation0"/></g><g><line x1="743" y1="1466" x2="1012" y2="1466" class="loopLine"/><line x1="1012" y1="1466" x2="1012" y2="1956" class="loopLine"/><line x1="743" y1="1956" x2="1012" y2="1956" class="loopLine"/><line x1="743" y1="1466" x2="743" y2="1956" class="loopLine"/><line x1="743" y1="1701" x2="1012" y2="1701" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="743,1466 793,1466 793,1479 784.6,1486 743,1486" class="labelBox"/><text x="768" y="1479" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="902.5" y="1484" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="902.5">[新会话]</tspan></text><text x="877.5" y="1719" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[已有会话]</text></g><g><line x1="733" y1="1375" x2="1370" y2="1375" class="loopLine"/><line x1="1370" y1="1375" x2="1370" y2="2046.6666666666667" class="loopLine"/><line x1="733" y1="2046.6666666666667" x2="1370" y2="2046.6666666666667" class="loopLine"/><line x1="733" y1="1375" x2="733" y2="2046.6666666666667" class="loopLine"/><polygon points="733,1375 783,1375 783,1388 774.6,1395 733,1395" class="labelBox"/><text x="758" y="1388" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">opt</text><text x="1076.5" y="1393" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="1076.5">[conversation_id存在]</tspan></text></g><g><rect x="50" y="2086.666666666667" fill="#EDF2AE" stroke="#666" width="3361" height="37" class="note"/><text x="1731" y="2092" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1731">【阶段3】上下文分析与查询增强</tspan></text></g><g><rect x="1074" y="2216.666666666667" fill="#EDF2AE" stroke="#666" width="10" height="841.6666666666665" class="activation0"/></g><g><line x1="999" y1="2317.166666666667" x2="3168" y2="2317.166666666667" class="loopLine"/><line x1="3168" y1="2317.166666666667" x2="3168" y2="2591.166666666667" class="loopLine"/><line x1="999" y1="2591.166666666667" x2="3168" y2="2591.166666666667" class="loopLine"/><line x1="999" y1="2317.166666666667" x2="999" y2="2591.166666666667" class="loopLine"/><line x1="999" y1="2443.166666666667" x2="3168" y2="2443.166666666667" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="999,2317.166666666667 1049,2317.166666666667 1049,2330.166666666667 1040.6,2337.166666666667 999,2337.166666666667" class="labelBox"/><text x="1024" y="2330" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="2108.5" y="2335" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="2108.5">[检测到指代词或查询过短(&lt;10字符)]</tspan></text><text x="2083.5" y="2461" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[无明显指代]</text></g><g><rect x="1104" y="2833.666666666667" fill="#EDF2AE" stroke="#666" width="150" height="88" class="note"/><text x="1179" y="2839" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1179">改写规则：</tspan></text><text x="1179" y="2856" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1179">• 替换指代词为具体实体</tspan></text><text x="1179" y="2873" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1179">• 补全省略的主语/宾语</tspan></text><text x="1179" y="2890" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1179">• 保持原始意图不变</tspan></text></g><g><line x1="1064" y1="2601.166666666667" x2="3168" y2="2601.166666666667" class="loopLine"/><line x1="3168" y1="2601.166666666667" x2="3168" y2="2977.666666666667" class="loopLine"/><line x1="1064" y1="2977.666666666667" x2="3168" y2="2977.666666666667" class="loopLine"/><line x1="1064" y1="2601.166666666667" x2="1064" y2="2977.666666666667" class="loopLine"/><polygon points="1064,2601.166666666667 1114,2601.166666666667 1114,2614.166666666667 1105.6,2621.166666666667 1064,2621.166666666667" class="labelBox"/><text x="1089" y="2614" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">opt</text><text x="2141" y="2619" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="2141">[is_contextual=true]</tspan></text></g><g><line x1="989" y1="2133.666666666667" x2="3178" y2="2133.666666666667" class="loopLine"/><line x1="3178" y1="2133.666666666667" x2="3178" y2="3068.3333333333335" class="loopLine"/><line x1="989" y1="3068.3333333333335" x2="3178" y2="3068.3333333333335" class="loopLine"/><line x1="989" y1="2133.666666666667" x2="989" y2="3068.3333333333335" class="loopLine"/><polygon points="989,2133.666666666667 1039,2133.666666666667 1039,2146.666666666667 1030.6,2153.666666666667 989,2153.666666666667" class="labelBox"/><text x="1014" y="2146" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">opt</text><text x="2108.5" y="2151" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="2108.5">[存在对话历史]</tspan></text></g><g><rect x="50" y="3230.8333333333335" fill="#EDF2AE" stroke="#666" width="3361" height="37" class="note"/><text x="1731" y="3236" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1731">【阶段4】多路检索执行 (Multi-Channel Retrieval)</tspan></text></g><g><rect x="1703" y="3315.8333333333335" fill="#EDF2AE" stroke="#666" width="10" height="5029.083333333334" class="activation0"/></g><g><rect x="1733" y="3553.3333333333335" fill="#EDF2AE" stroke="#666" width="225" height="105" class="note"/><text x="1846" y="3558" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1846">扩展策略：</tspan></text><text x="1846" y="3575" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1846">• 基于意图：FAQ/info/troubleshooting</tspan></text><text x="1846" y="3592" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1846">• 关键词组合</tspan></text><text x="1846" y="3609" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1846">• 同义词替换</tspan></text><text x="1846" y="3626" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1846">最多8个扩展查询</tspan></text></g><g><line x1="1571" y1="3432.3333333333335" x2="1968" y2="3432.3333333333335" class="loopLine"/><line x1="1968" y1="3432.3333333333335" x2="1968" y2="3792.3333333333335" class="loopLine"/><line x1="1571" y1="3792.3333333333335" x2="1968" y2="3792.3333333333335" class="loopLine"/><line x1="1571" y1="3432.3333333333335" x2="1571" y2="3792.3333333333335" class="loopLine"/><polygon points="1571,3432.3333333333335 1621,3432.3333333333335 1621,3445.3333333333335 1612.6,3452.3333333333335 1571,3452.3333333333335" class="labelBox"/><text x="1596" y="3445" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">opt</text><text x="1794.5" y="3450" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="1794.5">[enable_query_expansion=true]</tspan></text></g><g><line x1="1562.5" y1="3802.3333333333335" x2="1863.5" y2="3802.3333333333335" class="loopLine"/><line x1="1863.5" y1="3802.3333333333335" x2="1863.5" y2="4047.3333333333335" class="loopLine"/><line x1="1562.5" y1="4047.3333333333335" x2="1863.5" y2="4047.3333333333335" class="loopLine"/><line x1="1562.5" y1="3802.3333333333335" x2="1562.5" y2="4047.3333333333335" class="loopLine"/><polygon points="1562.5,3802.3333333333335 1612.5,3802.3333333333335 1612.5,3815.3333333333335 1604.1,3822.3333333333335 1562.5,3822.3333333333335" class="labelBox"/><text x="1588" y="3815" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">opt</text><text x="1738" y="3820" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="1738">[context存在]</tspan></text></g><g><rect x="1978" y="4234.333333333334" fill="#EDF2AE" stroke="#666" width="10" height="563.666666666667" class="activation0"/></g><g><line x1="1891.5" y1="4334.833333333334" x2="2084.5" y2="4334.833333333334" class="loopLine"/><line x1="2084.5" y1="4334.833333333334" x2="2084.5" y2="4734.000000000001" class="loopLine"/><line x1="1891.5" y1="4734.000000000001" x2="2084.5" y2="4734.000000000001" class="loopLine"/><line x1="1891.5" y1="4334.833333333334" x2="1891.5" y2="4734.000000000001" class="loopLine"/><line x1="1891.5" y1="4460.833333333334" x2="2084.5" y2="4460.833333333334" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="1891.5,4334.833333333334 1941.5,4334.833333333334 1941.5,4347.833333333334 1933.1,4354.833333333334 1891.5,4354.833333333334" class="labelBox"/><text x="1917" y="4347" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="2013" y="4352" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="2013">[缓存命中]</tspan></text><text x="1988" y="4478" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[缓存未命中]</text></g><g><rect x="2192" y="4891.000000000001" fill="#EDF2AE" stroke="#666" width="10" height="377.33333333333303" class="activation0"/></g><g><line x1="2104.5" y1="4899.000000000001" x2="2299.5" y2="4899.000000000001" class="loopLine"/><line x1="2299.5" y1="4899.000000000001" x2="2299.5" y2="5222.333333333334" class="loopLine"/><line x1="2104.5" y1="5222.333333333334" x2="2299.5" y2="5222.333333333334" class="loopLine"/><line x1="2104.5" y1="4899.000000000001" x2="2104.5" y2="5222.333333333334" class="loopLine"/><line x1="2104.5" y1="5058.333333333334" x2="2299.5" y2="5058.333333333334" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="2104.5,4899.000000000001 2154.5,4899.000000000001 2154.5,4912.000000000001 2146.1,4919.000000000001 2104.5,4919.000000000001" class="labelBox"/><text x="2130" y="4912" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="2227" y="4917" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="2227">[FAISS索引]</tspan></text><text x="2202" y="5076" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[Milvus]</text></g><g><line x1="1628" y1="5404.583333333334" x2="1798" y2="5404.583333333334" class="loopLine"/><line x1="1798" y1="5404.583333333334" x2="1798" y2="5676.583333333334" class="loopLine"/><line x1="1628" y1="5676.583333333334" x2="1798" y2="5676.583333333334" class="loopLine"/><line x1="1628" y1="5404.583333333334" x2="1628" y2="5676.583333333334" class="loopLine"/><line x1="1628" y1="5530.583333333334" x2="1798" y2="5530.583333333334" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="1628,5404.583333333334 1678,5404.583333333334 1678,5417.583333333334 1669.6,5424.583333333334 1628,5424.583333333334" class="labelBox"/><text x="1653" y="5417" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="1738" y="5422" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="1738">[原始查询(i=0)]</tspan></text><text x="1713" y="5548" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[扩展查询(i&gt;0)]</text></g><g><line x1="1610" y1="4808.000000000001" x2="2309.5" y2="4808.000000000001" class="loopLine"/><line x1="2309.5" y1="4808.000000000001" x2="2309.5" y2="5868.583333333334" class="loopLine"/><line x1="1610" y1="5868.583333333334" x2="2309.5" y2="5868.583333333334" class="loopLine"/><line x1="1610" y1="4808.000000000001" x2="1610" y2="5868.583333333334" class="loopLine"/><polygon points="1610,4808.000000000001 1660,4808.000000000001 1660,4821.000000000001 1651.6,4828.000000000001 1610,4828.000000000001" class="labelBox"/><text x="1635" y="4821" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">loop</text><text x="1984.75" y="4826" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="1984.75">[每个(查询, 向量)]</tspan></text></g><g><line x1="1572.5" y1="6017.583333333334" x2="2524.5" y2="6017.583333333334" class="loopLine"/><line x1="2524.5" y1="6017.583333333334" x2="2524.5" y2="6751.083333333334" class="loopLine"/><line x1="1572.5" y1="6751.083333333334" x2="2524.5" y2="6751.083333333334" class="loopLine"/><line x1="1572.5" y1="6017.583333333334" x2="1572.5" y2="6751.083333333334" class="loopLine"/><line x1="1572.5" y1="6346.083333333334" x2="2524.5" y2="6346.083333333334" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="1572.5,6017.583333333334 1622.5,6017.583333333334 1622.5,6030.583333333334 1614.1,6037.583333333334 1572.5,6037.583333333334" class="labelBox"/><text x="1598" y="6030" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">par</text><text x="2073.5" y="6035" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="2073.5">[BM25检索]</tspan></text><text x="2048.5" y="6364" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[语义关键词检索]</text></g><g><line x1="1562.5" y1="4151.333333333334" x2="2534.5" y2="4151.333333333334" class="loopLine"/><line x1="2534.5" y1="4151.333333333334" x2="2534.5" y2="6976.416666666667" class="loopLine"/><line x1="1562.5" y1="6976.416666666667" x2="2534.5" y2="6976.416666666667" class="loopLine"/><line x1="1562.5" y1="4151.333333333334" x2="1562.5" y2="6976.416666666667" class="loopLine"/><line x1="1562.5" y1="5883.583333333334" x2="2534.5" y2="5883.583333333334" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="1562.5,4151.333333333334 1612.5,4151.333333333334 1612.5,4164.333333333334 1604.1,4171.333333333334 1562.5,4171.333333333334" class="labelBox"/><text x="1588" y="4164" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">par</text><text x="2073.5" y="4169" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="2073.5">[向量检索通道 (Vector Retrieval)]</tspan></text><text x="2048.5" y="5901" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[关键词检索通道 (Keyword Retrieval)]</text></g><g><rect x="2606" y="7040.916666666667" fill="#EDF2AE" stroke="#666" width="10" height="313" class="activation0"/></g><g><rect x="2636" y="7124.916666666667" fill="#EDF2AE" stroke="#666" width="296" height="89" class="note"/><text x="2784" y="7130" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="2784">融合算法：</tspan></text><text x="2784" y="7147" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="2784">• 向量结果权重: 0.6</tspan></text><text x="2784" y="7164" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="2784">• 关键词结果权重: 0.4</tspan></text><text x="2784" y="7181" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="2784">Score = 0.6*vec_score + 0.4*kw_score</tspan></text></g><g><rect x="2952" y="7446.916666666667" fill="#EDF2AE" stroke="#666" width="10" height="619.5" class="activation0"/></g><g><line x1="2837.5" y1="7454.916666666667" x2="3086.5" y2="7454.916666666667" class="loopLine"/><line x1="3086.5" y1="7454.916666666667" x2="3086.5" y2="7761.416666666667" class="loopLine"/><line x1="2837.5" y1="7761.416666666667" x2="3086.5" y2="7761.416666666667" class="loopLine"/><line x1="2837.5" y1="7454.916666666667" x2="2837.5" y2="7761.416666666667" class="loopLine"/><line x1="2837.5" y1="7598.916666666667" x2="3086.5" y2="7598.916666666667" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="2837.5,7454.916666666667 2887.5,7454.916666666667 2887.5,7467.916666666667 2879.1,7474.916666666667 2837.5,7474.916666666667" class="labelBox"/><text x="2863" y="7467" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="2987" y="7472" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="2987">[BGE Reranker]</tspan></text><text x="2962" y="7616" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[CrossEncoder]</text></g><g><line x1="1693" y1="7363.916666666667" x2="3096.5" y2="7363.916666666667" class="loopLine"/><line x1="3096.5" y1="7363.916666666667" x2="3096.5" y2="8076.416666666667" class="loopLine"/><line x1="1693" y1="8076.416666666667" x2="3096.5" y2="8076.416666666667" class="loopLine"/><line x1="1693" y1="7363.916666666667" x2="1693" y2="8076.416666666667" class="loopLine"/><polygon points="1693,7363.916666666667 1743,7363.916666666667 1743,7376.916666666667 1734.6,7383.916666666667 1693,7383.916666666667" class="labelBox"/><text x="1718" y="7376" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">opt</text><text x="2419.75" y="7381" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="2419.75">[enable_rerank=true且重排序器已加载]</tspan></text></g><g><rect x="50" y="8384.916666666668" fill="#EDF2AE" stroke="#666" width="3361" height="37" class="note"/><text x="1731" y="8390" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1731">【阶段5】上下文构建与Prompt工程</tspan></text></g><g><rect x="1380" y="8581.916666666668" fill="#EDF2AE" stroke="#666" width="152" height="105" class="note"/><text x="1456" y="8587" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1456">上下文构建策略：</tspan></text><text x="1456" y="8604" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1456">• 按相似度排序</tspan></text><text x="1456" y="8621" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1456">• 格式化片段：[参考文档i]</tspan></text><text x="1456" y="8638" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1456">• 最大长度限制：4000-6000字符</tspan></text><text x="1456" y="8655" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1456">• 超长自动截断</tspan></text></g><g><line x1="1275" y1="8755.916666666668" x2="1445" y2="8755.916666666668" class="loopLine"/><line x1="1445" y1="8755.916666666668" x2="1445" y2="9089.916666666668" class="loopLine"/><line x1="1275" y1="9089.916666666668" x2="1445" y2="9089.916666666668" class="loopLine"/><line x1="1275" y1="8755.916666666668" x2="1275" y2="9089.916666666668" class="loopLine"/><line x1="1275" y1="8928.916666666668" x2="1445" y2="8928.916666666668" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="1275,8755.916666666668 1325,8755.916666666668 1325,8768.916666666668 1316.6,8775.916666666668 1275,8775.916666666668" class="labelBox"/><text x="1300" y="8768" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="1385" y="8773" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="1385">[当前长度 + 片段长度 ≤</tspan></text><text x="1385" y="8790" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="1385">max_contex-</tspan></text><text x="1385" y="8808" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="1385">t_length]</tspan></text><text x="1360" y="8946" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[超出长度限制]</text></g><g><line x1="1265" y1="8696.916666666668" x2="1455" y2="8696.916666666668" class="loopLine"/><line x1="1455" y1="8696.916666666668" x2="1455" y2="9099.916666666668" class="loopLine"/><line x1="1265" y1="9099.916666666668" x2="1455" y2="9099.916666666668" class="loopLine"/><line x1="1265" y1="8696.916666666668" x2="1265" y2="9099.916666666668" class="loopLine"/><polygon points="1265,8696.916666666668 1315,8696.916666666668 1315,8709.916666666668 1306.6,8716.916666666668 1265,8716.916666666668" class="labelBox"/><text x="1290" y="8709" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">loop</text><text x="1385" y="8714" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="1385">[每个result in</tspan></text><text x="1385" y="8731" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="1385">results]</tspan></text></g><g><line x1="1244.5" y1="9109.916666666668" x2="1475.5" y2="9109.916666666668" class="loopLine"/><line x1="1475.5" y1="9109.916666666668" x2="1475.5" y2="9277.416666666668" class="loopLine"/><line x1="1244.5" y1="9277.416666666668" x2="1475.5" y2="9277.416666666668" class="loopLine"/><line x1="1244.5" y1="9109.916666666668" x2="1244.5" y2="9277.416666666668" class="loopLine"/><polygon points="1244.5,9109.916666666668 1294.5,9109.916666666668 1294.5,9122.916666666668 1286.1,9129.916666666668 1244.5,9129.916666666668" class="labelBox"/><text x="1270" y="9122" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">opt</text><text x="1385" y="9127" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="1385">[context_summary存在]</tspan></text></g><g><rect x="1380" y="9363.416666666668" fill="#EDF2AE" stroke="#666" width="150" height="241" class="note"/><text x="1455" y="9368" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">Prompt模板：</tspan></text><text x="1455" y="9385" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">系统提示 + 参考文档 + 问题</tspan></text><text x="1455" y="9402" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">​</tspan></text><text x="1455" y="9419" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">"请根据以下参考文档回答问题。</tspan></text><text x="1455" y="9436" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">如果文档中没有相关信息，</tspan></text><text x="1455" y="9453" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">请明确说明。"</tspan></text><text x="1455" y="9471" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">​</tspan></text><text x="1455" y="9488" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">参考文档:</tspan></text><text x="1455" y="9505" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">{context}</tspan></text><text x="1455" y="9522" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">​</tspan></text><text x="1455" y="9539" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">问题: {query}</tspan></text><text x="1455" y="9556" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">​</tspan></text><text x="1455" y="9573" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">回答:</tspan></text></g><g><rect x="50" y="9644.416666666668" fill="#EDF2AE" stroke="#666" width="3361" height="37" class="note"/><text x="1731" y="9649" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1731">【阶段6】大模型生成 (Multi-Provider)</tspan></text></g><g><rect x="3152" y="9729.416666666668" fill="#EDF2AE" stroke="#666" width="10" height="1232.5" class="activation0"/></g><g><rect x="3182" y="9968.916666666668" fill="#EDF2AE" stroke="#666" width="150" height="89" class="note"/><text x="3257" y="9974" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3257">参数：</tspan></text><text x="3257" y="9991" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3257">• temperature: 0.7</tspan></text><text x="3257" y="10008" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3257">• max_tokens: 2000</tspan></text><text x="3257" y="10026" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3257">• system prompt固定</tspan></text></g><g><rect x="3182" y="10436.916666666668" fill="#EDF2AE" stroke="#666" width="179" height="157" class="note"/><text x="3272" y="10442" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3272">支持模型：</tspan></text><text x="3272" y="10459" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3272">• Qwen2.5-7B-Instruct</tspan></text><text x="3272" y="10476" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3272">• Qwen2.5-0.5B-Instruct</tspan></text><text x="3272" y="10493" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3272">​</tspan></text><text x="3272" y="10510" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3272">优化策略：</tspan></text><text x="3272" y="10527" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3272">• 8bit/4bit量化</tspan></text><text x="3272" y="10544" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3272">• device_map="auto"</tspan></text><text x="3272" y="10562" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3272">• torch.float16/float32</tspan></text></g><g><line x1="3011" y1="9737.416666666668" x2="3371" y2="9737.416666666668" class="loopLine"/><line x1="3371" y1="9737.416666666668" x2="3371" y2="10915.916666666668" class="loopLine"/><line x1="3011" y1="10915.916666666668" x2="3371" y2="10915.916666666668" class="loopLine"/><line x1="3011" y1="9737.416666666668" x2="3011" y2="10915.916666666668" class="loopLine"/><line x1="3011" y1="10072.916666666668" x2="3371" y2="10072.916666666668" class="loopLine" style="stroke-dasharray: 3, 3;"/><line x1="3011" y1="10302.916666666668" x2="3371" y2="10302.916666666668" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="3011,9737.416666666668 3061,9737.416666666668 3061,9750.416666666668 3052.6,9757.416666666668 3011,9757.416666666668" class="labelBox"/><text x="3036" y="9750" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="3216" y="9755" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="3216">[OpenAI]</tspan></text><text x="3191" y="10090" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[Anthropic]</text><text x="3191" y="10320" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[本地模型]</text></g><g><rect x="3152" y="11071.416666666668" fill="#EDF2AE" stroke="#666" width="10" height="126.75" class="activation0"/></g><g><line x1="1340" y1="10971.916666666668" x2="3255" y2="10971.916666666668" class="loopLine"/><line x1="3255" y1="10971.916666666668" x2="3255" y2="11238.166666666668" class="loopLine"/><line x1="1340" y1="11238.166666666668" x2="3255" y2="11238.166666666668" class="loopLine"/><line x1="1340" y1="10971.916666666668" x2="1340" y2="11238.166666666668" class="loopLine"/><polygon points="1340,10971.916666666668 1390,10971.916666666668 1390,10984.916666666668 1381.6,10991.916666666668 1340,10991.916666666668" class="labelBox"/><text x="1365" y="10984" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">opt</text><text x="2322.5" y="10989" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="2322.5">[使用本地模型]</tspan></text></g><g><rect x="50" y="11278.166666666668" fill="#EDF2AE" stroke="#666" width="3361" height="37" class="note"/><text x="1731" y="11283" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1731">【阶段7】响应封装与会话更新</tspan></text></g><g><rect x="1380" y="11399.166666666668" fill="#EDF2AE" stroke="#666" width="150" height="88" class="note"/><text x="1455" y="11404" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">引用格式：</tspan></text><text x="1455" y="11421" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">\n\n引用来源：</tspan></text><text x="1455" y="11438" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">[1] 文档名, 相似度: 0.95</tspan></text><text x="1455" y="11455" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1455">[2] 文档名, 相似度: 0.88</tspan></text></g><g><rect x="867.5" y="11659.416666666668" fill="#EDF2AE" stroke="#666" width="10" height="245.33333333333394" class="activation0"/></g><g><rect x="50" y="12104.500000000002" fill="#EDF2AE" stroke="#666" width="3361" height="37" class="note"/><text x="1731" y="12110" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="1731">【附录】文档预处理与索引流程</tspan></text></g><g><rect x="3381" y="12187.500000000002" fill="#EDF2AE" stroke="#666" width="10" height="2110.25" class="activation0"/></g><g><rect x="3411" y="12567.500000000002" fill="#EDF2AE" stroke="#666" width="170" height="105" class="note"/><text x="3496" y="12573" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3496">支持格式：</tspan></text><text x="3496" y="12590" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3496">• PDF (PyMuPDF)</tspan></text><text x="3496" y="12607" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3496">• DOCX (python-docx)</tspan></text><text x="3496" y="12624" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3496">• TXT</tspan></text><text x="3496" y="12641" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="noteText" dy="1em" style="font-size: 16px; font-weight: 400;"><tspan x="3496">• MD</tspan></text></g><g><rect x="3386" y="12767.000000000002" fill="#EDF2AE" stroke="#666" width="10" height="641.0833333333339" class="activation1"/></g><g><line x1="3290.5" y1="12867.500000000002" x2="3501.5" y2="12867.500000000002" class="loopLine"/><line x1="3501.5" y1="12867.500000000002" x2="3501.5" y2="13223.083333333336" class="loopLine"/><line x1="3290.5" y1="13223.083333333336" x2="3501.5" y2="13223.083333333336" class="loopLine"/><line x1="3290.5" y1="12867.500000000002" x2="3290.5" y2="13223.083333333336" class="loopLine"/><line x1="3290.5" y1="13043.750000000002" x2="3501.5" y2="13043.750000000002" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="3290.5,12867.500000000002 3340.5,12867.500000000002 3340.5,12880.500000000002 3332.1,12887.500000000002 3290.5,12887.500000000002" class="labelBox"/><text x="3316" y="12880" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="3421" y="12885" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="3421">[智能切分模式]</tspan></text><text x="3396" y="13061" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[朴素切分模式]</text></g><g><rect x="1978" y="13472.583333333336" fill="#EDF2AE" stroke="#666" width="10" height="156" class="activation0"/></g><g><rect x="2192" y="13676.583333333336" fill="#EDF2AE" stroke="#666" width="10" height="375.16666666666606" class="activation0"/></g><g><line x1="2117" y1="13684.583333333336" x2="2287" y2="13684.583333333336" class="loopLine"/><line x1="2287" y1="13684.583333333336" x2="2287" y2="14007.750000000002" class="loopLine"/><line x1="2117" y1="14007.750000000002" x2="2287" y2="14007.750000000002" class="loopLine"/><line x1="2117" y1="13684.583333333336" x2="2117" y2="14007.750000000002" class="loopLine"/><line x1="2117" y1="13845.250000000002" x2="2287" y2="13845.250000000002" class="loopLine" style="stroke-dasharray: 3, 3;"/><polygon points="2117,13684.583333333336 2167,13684.583333333336 2167,13697.583333333336 2158.6,13704.583333333336 2117,13704.583333333336" class="labelBox"/><text x="2142" y="13697" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="labelText" style="font-size: 16px; font-weight: 400;">alt</text><text x="2227" y="13702" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;"><tspan x="2227">[FAISS]</tspan></text><text x="2202" y="13863" text-anchor="middle" class="loopText" style="font-size: 16px; font-weight: 400;">[Milvus]</text></g><text x="230" y="147" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">POST /rag/generate</text><text x="230" y="164" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">RAGRequest{query, conversation_id,</text><text x="230" y="182" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">retrieval_config, generation_config}</text><line x1="76" y1="214" x2="384" y2="214" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="76" y1="214" x2="76" y2="214" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="76" y="218" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">1</text><text x="528" y="229" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">recognize(query)</text><line x1="393" y1="260" x2="662" y2="260" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="393" y1="260" x2="393" y2="260" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="393" y="264" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">2</text><text x="671" y="275" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_rule_based_recognize()</text><text x="671" y="293" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">关键词/正则快速匹配</text><path d="M 671,322.5 C 731,312.5 731,352.5 671,342.5" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="671" y1="322.5" x2="671" y2="322.5" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="671" y="326.5" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">3</text><text x="671" y="562" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">直接返回规则结果</text><path d="M 671,590.5 C 731,580.5 731,620.5 671,610.5" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="671" y1="590.5" x2="671" y2="590.5" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="671" y="594.5" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">4</text><text x="1912" y="681" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_llm_based_recognize()</text><text x="1912" y="699" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">构建意图识别Prompt</text><line x1="671" y1="729.5" x2="3153" y2="729.5" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="671" y1="729.5" x2="671" y2="729.5" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="671" y="733.5" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">5</text><text x="1915" y="745" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">JSON格式意图</text><text x="1915" y="762" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">{intent, confidence, reason}</text><line x1="3156" y1="790.5" x2="674" y2="790.5" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="3156" y1="790.5" x2="3156" y2="790.5" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3156" y="794.5" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">6</text><text x="671" y="806" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">解析并验证意图类型</text><path d="M 671,834.5 C 731,824.5 731,864.5 671,854.5" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="671" y1="834.5" x2="671" y2="834.5" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="671" y="838.5" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">7</text><text x="529" y="920" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">(IntentType, confidence, details)</text><line x1="661" y1="950.5" x2="396" y2="950.5" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="661" y1="950.5" x2="661" y2="950.5" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="661" y="954.5" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">8</text><text x="393" y="1064" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">根据意图动态调整检索配置</text><text x="393" y="1081" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">IntentConfig.get_config(intent)</text><path d="M 393,1111 C 453,1101 453,1141 393,1131" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="393" y1="1111" x2="393" y2="1111" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="393" y="1115" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">9</text><text x="872" y="1334" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">generate(query, config, conversation_id)</text><line x1="393" y1="1365" x2="1351" y2="1365" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="393" y1="1365" x2="393" y2="1365" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="393" y="1369" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">10</text><text x="1113" y="1425" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">get_conversation(conversation_id)</text><line x1="1350" y1="1456" x2="876.5" y2="1456" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1350" y1="1456" x2="1350" y2="1456" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1350" y="1460" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">11</text><text x="878" y="1516" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">create_conversation()</text><text x="878" y="1534" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">生成UUID作为会话ID</text><path d="M 877.5,1563.5 C 937.5,1553.5 937.5,1593.5 877.5,1583.5" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="877.5" y1="1563.5" x2="877.5" y2="1563.5" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="877.5" y="1567.5" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">12</text><text x="878" y="1609" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">初始化会话状态</text><text x="878" y="1626" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">messages=[], metadata={}</text><path d="M 877.5,1656 C 937.5,1646 937.5,1686 877.5,1676" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="877.5" y1="1656" x2="877.5" y2="1656" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="877.5" y="1660" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">13</text><text x="878" y="1746" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">从内存加载会话</text><text x="878" y="1763" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">self.conversations[conversation_id]</text><path d="M 877.5,1793.5 C 937.5,1783.5 937.5,1823.5 877.5,1813.5" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="877.5" y1="1793.5" x2="877.5" y2="1793.5" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="877.5" y="1797.5" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">14</text><text x="878" y="1839" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">恢复对话历史</text><text x="878" y="1856" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">最近max_history_length=20条</text><path d="M 877.5,1886 C 937.5,1876 937.5,1916 877.5,1906" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="877.5" y1="1886" x2="877.5" y2="1886" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="877.5" y="1890" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">15</text><text x="1112" y="1971" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">Conversation对象</text><text x="1112" y="1988" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">{id, messages[], created_at,</text><text x="1112" y="2006" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">last_updated}</text><line x1="877.5" y1="2036.6666666666667" x2="1347" y2="2036.6666666666667" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="877.5" y1="2036.6666666666667" x2="877.5" y2="2036.6666666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="877.5" y="2040.6666666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">16</text><text x="1217" y="2184" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">analyze_context(history, query)</text><line x1="1350" y1="2214.666666666667" x2="1083" y2="2214.666666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1350" y1="2214.666666666667" x2="1350" y2="2214.666666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1350" y="2218.666666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">17</text><text x="1084" y="2230" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">规则快速检测</text><text x="1084" y="2247" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">指代词检测(它/这/那/该/此/其/这个/那个)</text><path d="M 1084,2277.166666666667 C 1144,2267.166666666667 1144,2307.166666666667 1084,2297.166666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1084" y1="2277.166666666667" x2="1084" y2="2277.166666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1084" y="2281.166666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">18</text><text x="1084" y="2367" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">is_contextual = true</text><path d="M 1084,2398.166666666667 C 1144,2388.166666666667 1144,2428.166666666667 1084,2418.166666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1084" y1="2398.166666666667" x2="1084" y2="2398.166666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1084" y="2402.166666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">19</text><text x="2119" y="2488" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_llm_is_contextual()</text><text x="2119" y="2506" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">构建判断Prompt</text><line x1="1084" y1="2537.166666666667" x2="3153" y2="2537.166666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1084" y1="2537.166666666667" x2="1084" y2="2537.166666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1084" y="2541.166666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">20</text><text x="2122" y="2552" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">是/否</text><line x1="3156" y1="2581.166666666667" x2="1087" y2="2581.166666666667" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="3156" y1="2581.166666666667" x2="3156" y2="2581.166666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3156" y="2585.166666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">21</text><text x="2119" y="2651" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_llm_extract_context_info()</text><text x="2119" y="2669" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">抽取：核心主题/关键实体/上下文摘要</text><line x1="1084" y1="2698.666666666667" x2="3153" y2="2698.666666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1084" y1="2698.666666666667" x2="1084" y2="2698.666666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1084" y="2702.666666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">22</text><text x="2122" y="2714" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">结构化信息</text><text x="2122" y="2731" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">{main_topic, entities[], context_summary}</text><line x1="3156" y1="2761.166666666667" x2="1087" y2="2761.166666666667" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="3156" y1="2761.166666666667" x2="3156" y2="2761.166666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3156" y="2765.166666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">23</text><text x="2119" y="2776" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_llm_rewrite_query()</text><text x="2119" y="2794" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">指代消解 + 省略补全</text><line x1="1084" y1="2823.666666666667" x2="3153" y2="2823.666666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1084" y1="2823.666666666667" x2="1084" y2="2823.666666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1084" y="2827.666666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">24</text><text x="2122" y="2937" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">rewritten_query</text><line x1="3156" y1="2967.666666666667" x2="1087" y2="2967.666666666667" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="3156" y1="2967.666666666667" x2="3156" y2="2967.666666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3156" y="2971.666666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">25</text><text x="1216" y="2993" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">分析结果</text><text x="1216" y="3010" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">{is_contextual, rewritten_query,</text><text x="1216" y="3028" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">context_summary, entities[]}</text><line x1="1084" y1="3058.3333333333335" x2="1347" y2="3058.3333333333335" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="1084" y1="3058.3333333333335" x2="1084" y2="3058.3333333333335" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1084" y="3062.3333333333335" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">26</text><text x="1360" y="3083" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">确定最终查询</text><text x="1360" y="3100" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">main_query = rewritten_query or query</text><path d="M 1360,3130.8333333333335 C 1420,3120.8333333333335 1420,3160.8333333333335 1360,3150.8333333333335" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1360" y1="3130.8333333333335" x2="1360" y2="3130.8333333333335" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1360" y="3134.8333333333335" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">27</text><text x="1532" y="3283" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">retrieve(query, config, context, main_query)</text><line x1="1360" y1="3313.8333333333335" x2="1704" y2="3313.8333333333335" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1360" y1="3313.8333333333335" x2="1360" y2="3313.8333333333335" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1360" y="3317.8333333333335" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">28</text><text x="1187" y="3329" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">recognize_intent(main_query)</text><line x1="1703" y1="3359.8333333333335" x2="670" y2="3359.8333333333335" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1703" y1="3359.8333333333335" x2="1703" y2="3359.8333333333335" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1703" y="3363.8333333333335" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">29</text><text x="1184" y="3375" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">intent_info</text><text x="1184" y="3393" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">{intent, confidence}</text><line x1="667" y1="3422.3333333333335" x2="1700" y2="3422.3333333333335" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="667" y1="3422.3333333333335" x2="667" y2="3422.3333333333335" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="667" y="3426.3333333333335" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">30</text><text x="1713" y="3482" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_expand_query(main_query, intent_info)</text><path d="M 1713,3513.3333333333335 C 1773,3503.3333333333335 1773,3543.3333333333335 1713,3533.3333333333335" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="3513.3333333333335" x2="1713" y2="3513.3333333333335" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="3517.3333333333335" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">31</text><text x="1713" y="3673" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">expanded_queries[]</text><text x="1713" y="3691" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">[main_query + 扩展查询]</text><path d="M 1713,3722.3333333333335 C 1773,3712.3333333333335 1773,3752.3333333333335 1713,3742.3333333333335" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="3722.3333333333335" x2="1713" y2="3722.3333333333335" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="3726.3333333333335" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">32</text><text x="1713" y="3852" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_enhance_query_with_context()</text><text x="1713" y="3870" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">融合上下文关键词(最多5个)</text><path d="M 1713,3901.3333333333335 C 1773,3891.3333333333335 1773,3931.3333333333335 1713,3921.3333333333335" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="3901.3333333333335" x2="1713" y2="3901.3333333333335" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="3905.3333333333335" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">33</text><text x="1713" y="3946" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">expanded_queries.append(enhanced_query)</text><path d="M 1713,3977.3333333333335 C 1773,3967.3333333333335 1773,4007.3333333333335 1713,3997.3333333333335" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="3977.3333333333335" x2="1713" y2="3977.3333333333335" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="3981.3333333333335" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">34</text><text x="1713" y="4062" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_extract_core_keywords()</text><text x="1713" y="4080" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">提取核心关键词(最多5个)</text><path d="M 1713,4111.333333333334 C 1773,4101.333333333334 1773,4141.333333333334 1713,4131.333333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="4111.333333333334" x2="1713" y2="4111.333333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="4115.333333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">35</text><text x="1846" y="4201" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">encode(expanded_queries)</text><line x1="1713" y1="4232.333333333334" x2="1979" y2="4232.333333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="4232.333333333334" x2="1713" y2="4232.333333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="4236.333333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">36</text><text x="1988" y="4247" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">检查文本向量缓存</text><text x="1988" y="4264" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">LRU Cache (10,000条)</text><path d="M 1988,4294.833333333334 C 2048,4284.833333333334 2048,4324.833333333334 1988,4314.833333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1988" y1="4294.833333333334" x2="1988" y2="4294.833333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1988" y="4298.833333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">37</text><text x="1988" y="4385" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">返回cached_vector</text><path d="M 1988,4415.833333333334 C 2048,4405.833333333334 2048,4445.833333333334 1988,4435.833333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1988" y1="4415.833333333334" x2="1988" y2="4415.833333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1988" y="4419.833333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">38</text><text x="1988" y="4506" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">批量编码</text><text x="1988" y="4523" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">model.encode(batch_texts)</text><text x="1988" y="4541" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">batch_size: 32-128(动态调整)</text><path d="M 1988,4571.500000000001 C 2048,4561.500000000001 2048,4601.500000000001 1988,4591.500000000001" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1988" y1="4571.500000000001" x2="1988" y2="4571.500000000001" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1988" y="4575.500000000001" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">39</text><text x="1988" y="4617" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">更新缓存</text><text x="1988" y="4634" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">缓存淘汰策略(FIFO)</text><path d="M 1988,4664.000000000001 C 2048,4654.000000000001 2048,4694.000000000001 1988,4684.000000000001" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1988" y1="4664.000000000001" x2="1988" y2="4664.000000000001" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1988" y="4668.000000000001" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">40</text><text x="1847" y="4749" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">query_vectors[]</text><text x="1847" y="4767" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">shape: (n_queries, dimension)</text><line x1="1978" y1="4798.000000000001" x2="1716" y2="4798.000000000001" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="1978" y1="4798.000000000001" x2="1978" y2="4798.000000000001" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1978" y="4802.000000000001" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">41</text><text x="1953" y="4858" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">search(query_vector, top_k*2)</text><line x1="1713" y1="4889.000000000001" x2="2193" y2="4889.000000000001" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="4889.000000000001" x2="1713" y2="4889.000000000001" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="4893.000000000001" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">42</text><text x="2202" y="4949" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">IndexHNSWFlat.search()</text><text x="2202" y="4966" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">M=16, efConstruction=200</text><text x="2202" y="4983" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">efSearch=128</text><path d="M 2202,5013.333333333334 C 2262,5003.333333333334 2262,5043.333333333334 2202,5033.333333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="2202" y1="5013.333333333334" x2="2202" y2="5013.333333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2202" y="5017.333333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">43</text><text x="2202" y="5103" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">client.search()</text><text x="2202" y="5120" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">metric_type=COSINE</text><path d="M 2202,5152.333333333334 C 2262,5142.333333333334 2262,5182.333333333334 2202,5172.333333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="2202" y1="5152.333333333334" x2="2202" y2="5152.333333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2202" y="5156.333333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">44</text><text x="1954" y="5237" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">(distances, metadata_list)</text><line x1="2192" y1="5268.333333333334" x2="1716" y2="5268.333333333334" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="2192" y1="5268.333333333334" x2="2192" y2="5268.333333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2192" y="5272.333333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">45</text><text x="1713" y="5283" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_process_results()</text><text x="1713" y="5301" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">• 距离转相似度</text><text x="1713" y="5318" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">• 过滤空内容</text><text x="1713" y="5335" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">• 提取匹配关键词</text><path d="M 1713,5364.583333333334 C 1773,5354.583333333334 1773,5394.583333333334 1713,5384.583333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="5364.583333333334" x2="1713" y2="5364.583333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="5368.583333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">46</text><text x="1713" y="5455" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">weight = 1.0</text><path d="M 1713,5485.583333333334 C 1773,5475.583333333334 1773,5515.583333333334 1713,5505.583333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="5485.583333333334" x2="1713" y2="5485.583333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="5489.583333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">47</text><text x="1713" y="5576" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">weight = 0.7</text><path d="M 1713,5606.583333333334 C 1773,5596.583333333334 1773,5636.583333333334 1713,5626.583333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="5606.583333333334" x2="1713" y2="5606.583333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="5610.583333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">48</text><text x="1713" y="5692" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">result.similarity *= weight</text><path d="M 1713,5722.583333333334 C 1773,5712.583333333334 1773,5752.583333333334 1713,5742.583333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="5722.583333333334" x2="1713" y2="5722.583333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="5726.583333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">49</text><text x="1713" y="5768" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">vector_results.append(result)</text><path d="M 1713,5798.583333333334 C 1773,5788.583333333334 1773,5828.583333333334 1713,5818.583333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="5798.583333333334" x2="1713" y2="5798.583333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="5802.583333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">50</text><text x="1713" y="5929" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_extract_core_keywords()</text><text x="1713" y="5947" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">基于main_query提取</text><path d="M 1713,5977.583333333334 C 1773,5967.583333333334 1773,6007.583333333334 1713,5997.583333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="5977.583333333334" x2="1713" y2="5977.583333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="5981.583333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">51</text><text x="1713" y="6068" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_perform_bm25_retrieval()</text><path d="M 1713,6098.583333333334 C 1773,6088.583333333334 1773,6128.583333333334 1713,6118.583333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="6098.583333333334" x2="1713" y2="6098.583333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="6102.583333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">52</text><text x="2060" y="6144" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">构建BM25Okapi索引</text><text x="2060" y="6161" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">tokenized_corpus</text><line x1="1713" y1="6192.583333333334" x2="2407" y2="6192.583333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="6192.583333333334" x2="1713" y2="6192.583333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="6196.583333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">53</text><text x="2412" y="6208" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">bm25.get_scores(query_tokens)</text><path d="M 2412,6238.583333333334 C 2472,6228.583333333334 2472,6268.583333333334 2412,6258.583333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="2412" y1="6238.583333333334" x2="2412" y2="6238.583333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2412" y="6242.583333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">54</text><text x="2063" y="6284" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">bm25_results</text><text x="2063" y="6302" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">基于词频-逆文档频率</text><line x1="2410" y1="6331.083333333334" x2="1716" y2="6331.083333333334" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="2410" y1="6331.083333333334" x2="2410" y2="6331.083333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2410" y="6335.083333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">55</text><text x="1713" y="6391" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_perform_semantic_keyword_retrieval()</text><path d="M 1713,6422.083333333334 C 1773,6412.083333333334 1773,6452.083333333334 1713,6442.083333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="6422.083333333334" x2="1713" y2="6422.083333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="6426.083333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">56</text><text x="1846" y="6467" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">encode(keywords_text)</text><line x1="1713" y1="6498.083333333334" x2="1979" y2="6498.083333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="6498.083333333334" x2="1713" y2="6498.083333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="6502.083333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">57</text><text x="1849" y="6513" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">keyword_vector</text><line x1="1982" y1="6544.083333333334" x2="1716" y2="6544.083333333334" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="1982" y1="6544.083333333334" x2="1982" y2="6544.083333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1982" y="6548.083333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">58</text><text x="1713" y="6559" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">计算余弦相似度</text><text x="1713" y="6576" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">与所有chunks</text><path d="M 1713,6605.083333333334 C 1773,6595.083333333334 1773,6635.083333333334 1713,6625.083333333334" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="6605.083333333334" x2="1713" y2="6605.083333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="6609.083333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">59</text><text x="1713" y="6650" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">semantic_keyword_results</text><path d="M 1713,6681.083333333334 C 1773,6671.083333333334 1773,6711.083333333334 1713,6701.083333333334" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="1713" y1="6681.083333333334" x2="1713" y2="6681.083333333334" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="6685.083333333334" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">60</text><text x="1713" y="6766" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_fuse_keyword_results()</text><text x="1713" y="6784" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">基于chunk_id去重</text><text x="1713" y="6802" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">取max相似度分数</text><path d="M 1713,6830.416666666667 C 1773,6820.416666666667 1773,6860.416666666667 1713,6850.416666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="6830.416666666667" x2="1713" y2="6830.416666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="6834.416666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">61</text><text x="1713" y="6875" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">keyword_results</text><path d="M 1713,6906.416666666667 C 1773,6896.416666666667 1773,6936.416666666667 1713,6926.416666666667" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="1713" y1="6906.416666666667" x2="1713" y2="6906.416666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="6910.416666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">62</text><text x="2160" y="6991" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_fuse_retrieval_results()</text><text x="2160" y="7009" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">向量结果 + 关键词结果</text><line x1="1713" y1="7038.916666666667" x2="2607" y2="7038.916666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="7038.916666666667" x2="1713" y2="7038.916666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="7042.916666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">63</text><text x="2616" y="7054" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">基于chunk_id去重和融合</text><path d="M 2616,7084.916666666667 C 2676,7074.916666666667 2676,7114.916666666667 2616,7104.916666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="2616" y1="7084.916666666667" x2="2616" y2="7084.916666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2616" y="7088.916666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">64</text><text x="2616" y="7229" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">相似度排序(降序)</text><text x="2616" y="7246" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">取top_k*2结果</text><path d="M 2616,7277.916666666667 C 2676,7267.916666666667 2676,7307.916666666667 2616,7297.916666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="2616" y1="7277.916666666667" x2="2616" y2="7277.916666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2616" y="7281.916666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">65</text><text x="2161" y="7323" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">fused_results</text><line x1="2606" y1="7353.916666666667" x2="1716" y2="7353.916666666667" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="2606" y1="7353.916666666667" x2="2606" y2="7353.916666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2606" y="7357.916666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">66</text><text x="2333" y="7414" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">rerank_results(main_query, fused_results)</text><line x1="1713" y1="7444.916666666667" x2="2953" y2="7444.916666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="7444.916666666667" x2="1713" y2="7444.916666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="7448.916666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">67</text><text x="2962" y="7505" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">FlagReranker.compute_score(pairs)</text><text x="2962" y="7523" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">模型: BAAI/bge-reranker-v2-m3</text><path d="M 2962,7553.916666666667 C 3022,7543.916666666667 3022,7583.916666666667 2962,7573.916666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="2962" y1="7553.916666666667" x2="2962" y2="7553.916666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2962" y="7557.916666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">68</text><text x="2962" y="7644" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">CrossEncoder.predict(pairs)</text><text x="2962" y="7661" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">模型: ms-marco-MiniLM-L-6-v2</text><path d="M 2962,7691.416666666667 C 3022,7681.416666666667 3022,7721.416666666667 2962,7711.416666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="2962" y1="7691.416666666667" x2="2962" y2="7691.416666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2962" y="7695.416666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">69</text><text x="2962" y="7776" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">按重排序分数降序排列</text><path d="M 2962,7805.416666666667 C 3022,7795.416666666667 3022,7835.416666666667 2962,7825.416666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="2962" y1="7805.416666666667" x2="2962" y2="7805.416666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2962" y="7809.416666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">70</text><text x="2962" y="7850" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">应用阈值过滤</text><text x="2962" y="7867" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">reranker_threshold</text><path d="M 2962,7897.916666666667 C 3022,7887.916666666667 3022,7927.916666666667 2962,7917.916666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="2962" y1="7897.916666666667" x2="2962" y2="7897.916666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2962" y="7901.916666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">71</text><text x="2962" y="7943" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">更新result.similarity</text><text x="2962" y="7960" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">为reranker分数</text><path d="M 2962,7990.416666666667 C 3022,7980.416666666667 3022,8020.416666666667 2962,8010.416666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="2962" y1="7990.416666666667" x2="2962" y2="7990.416666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2962" y="7994.416666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">72</text><text x="2334" y="8035" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">reranked_results</text><line x1="2952" y1="8066.416666666667" x2="1716" y2="8066.416666666667" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="2952" y1="8066.416666666667" x2="2952" y2="8066.416666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2952" y="8070.416666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">73</text><text x="1713" y="8091" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">应用相似度阈值过滤</text><text x="1713" y="8108" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">similarity_threshold=0.4</text><path d="M 1713,8138.916666666667 C 1773,8128.916666666667 1773,8168.916666666667 1713,8158.916666666667" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="8138.916666666667" x2="1713" y2="8138.916666666667" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="8142.916666666667" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">74</text><text x="1713" y="8184" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">应用top_k限制</text><text x="1713" y="8202" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">final_results[:top_k]</text><path d="M 1713,8232.916666666668 C 1773,8222.916666666668 1773,8262.916666666668 1713,8252.916666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1713" y1="8232.916666666668" x2="1713" y2="8232.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1713" y="8236.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">75</text><text x="1533" y="8278" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">RetrievalResponse</text><text x="1533" y="8295" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">{query, rewritten_query, results[],</text><text x="1533" y="8313" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">total, latency_ms, intent, confidence}</text><line x1="1703" y1="8344.916666666668" x2="1363" y2="8344.916666666668" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="1703" y1="8344.916666666668" x2="1703" y2="8344.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1703" y="8348.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">76</text><text x="1360" y="8437" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_build_context(retrieval_results)</text><path d="M 1360,8467.916666666668 C 1420,8457.916666666668 1420,8497.916666666668 1360,8487.916666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1360" y1="8467.916666666668" x2="1360" y2="8467.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1360" y="8471.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">77</text><text x="1360" y="8513" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">遍历results构建上下文片段</text><path d="M 1360,8541.916666666668 C 1420,8531.916666666668 1420,8571.916666666668 1360,8561.916666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1360" y1="8541.916666666668" x2="1360" y2="8541.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1360" y="8545.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">78</text><text x="1360" y="8838" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">添加上下文片段</text><text x="1360" y="8855" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">【参考文档i】\ncontent</text><path d="M 1360,8883.916666666668 C 1420,8873.916666666668 1420,8913.916666666668 1360,8903.916666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1360" y1="8883.916666666668" x2="1360" y2="8883.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1360" y="8887.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">79</text><text x="1360" y="8974" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">截断并添加警告</text><text x="1360" y="8991" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">"上下文长度超过限制，截断..."</text><path d="M 1360,9019.916666666668 C 1420,9009.916666666668 1420,9049.916666666668 1360,9039.916666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1360" y1="9019.916666666668" x2="1360" y2="9019.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1360" y="9023.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">80</text><text x="1360" y="9160" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">前置添加对话历史摘要</text><text x="1360" y="9177" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">"对话历史摘要: {context_summary}\n\n"</text><path d="M 1360,9207.416666666668 C 1420,9197.416666666668 1420,9237.416666666668 1360,9227.416666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1360" y1="9207.416666666668" x2="1360" y2="9207.416666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1360" y="9211.416666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">81</text><text x="1360" y="9292" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_build_prompt(query, full_context)</text><path d="M 1360,9323.416666666668 C 1420,9313.416666666668 1420,9353.416666666668 1360,9343.416666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1360" y1="9323.416666666668" x2="1360" y2="9323.416666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1360" y="9327.416666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">82</text><text x="2257" y="9696" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">generate(prompt)</text><line x1="1360" y1="9727.416666666668" x2="3153" y2="9727.416666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1360" y1="9727.416666666668" x2="1360" y2="9727.416666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1360" y="9731.416666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">83</text><text x="3162" y="9787" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">openai.OpenAI()</text><text x="3162" y="9804" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">初始化客户端</text><path d="M 3162,9834.916666666668 C 3222,9824.916666666668 3222,9864.916666666668 3162,9854.916666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3162" y1="9834.916666666668" x2="3162" y2="9834.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3162" y="9838.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">84</text><text x="3162" y="9880" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">client.chat.completions.create()</text><text x="3162" y="9897" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">模型: gpt-3.5-turbo/gpt-4</text><path d="M 3162,9928.916666666668 C 3222,9918.916666666668 3222,9958.916666666668 3162,9948.916666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3162" y1="9928.916666666668" x2="3162" y2="9928.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3162" y="9932.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">85</text><text x="3162" y="10118" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">anthropic.Anthropic()</text><text x="3162" y="10135" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">初始化客户端</text><path d="M 3162,10165.416666666668 C 3222,10155.416666666668 3222,10195.416666666668 3162,10185.416666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3162" y1="10165.416666666668" x2="3162" y2="10165.416666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3162" y="10169.416666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">86</text><text x="3162" y="10210" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">client.messages.create()</text><text x="3162" y="10227" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">模型: Claude系列</text><path d="M 3162,10257.916666666668 C 3222,10247.916666666668 3222,10287.916666666668 3162,10277.916666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3162" y1="10257.916666666668" x2="3162" y2="10257.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3162" y="10261.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">87</text><text x="3162" y="10348" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">AutoTokenizer.from_pretrained()</text><text x="3162" y="10366" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">AutoModelForCausalLM.from_pretrained()</text><path d="M 3162,10396.916666666668 C 3222,10386.916666666668 3222,10426.916666666668 3162,10416.916666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3162" y1="10396.916666666668" x2="3162" y2="10396.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3162" y="10400.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">88</text><text x="3162" y="10609" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">tokenizer.apply_chat_template()</text><text x="3162" y="10627" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">构建messages格式</text><path d="M 3162,10657.916666666668 C 3222,10647.916666666668 3222,10687.916666666668 3162,10677.916666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3162" y1="10657.916666666668" x2="3162" y2="10657.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3162" y="10661.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">89</text><text x="3162" y="10703" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">model.generate()</text><text x="3162" y="10720" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">max_new_tokens, temperature</text><path d="M 3162,10751.916666666668 C 3222,10741.916666666668 3222,10781.916666666668 3162,10771.916666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3162" y1="10751.916666666668" x2="3162" y2="10751.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3162" y="10755.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">90</text><text x="3162" y="10797" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">tokenizer.decode()</text><text x="3162" y="10814" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">skip_special_tokens=True</text><path d="M 3162,10845.916666666668 C 3222,10835.916666666668 3222,10875.916666666668 3162,10865.916666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3162" y1="10845.916666666668" x2="3162" y2="10845.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3162" y="10849.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">91</text><text x="2258" y="10931" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">generated_answer</text><line x1="3152" y1="10961.916666666668" x2="1363" y2="10961.916666666668" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="3152" y1="10961.916666666668" x2="3152" y2="10961.916666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3152" y="10965.916666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">92</text><text x="2257" y="11022" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">unload()</text><text x="2257" y="11039" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">释放显存</text><line x1="1360" y1="11069.416666666668" x2="3153" y2="11069.416666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1360" y1="11069.416666666668" x2="1360" y2="11069.416666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1360" y="11073.416666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">93</text><text x="3162" y="11084" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">model.to('cpu')</text><text x="3162" y="11101" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">del model/tokenizer</text><text x="3162" y="11118" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">torch.cuda.empty_cache()</text><text x="3162" y="11136" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">torch.cuda.ipc_collect()</text><path d="M 3162,11168.166666666668 C 3222,11158.166666666668 3222,11198.166666666668 3162,11188.166666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3162" y1="11168.166666666668" x2="3162" y2="11168.166666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3162" y="11172.166666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">94</text><text x="1360" y="11330" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">添加引用来源标注</text><path d="M 1360,11359.166666666668 C 1420,11349.166666666668 1420,11389.166666666668 1360,11379.166666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1360" y1="11359.166666666668" x2="1360" y2="11359.166666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1360" y="11363.166666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">95</text><text x="1360" y="11502" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">计算耗时统计</text><text x="1360" y="11519" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">retrieval_time_ms</text><text x="1360" y="11537" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">generation_time_ms</text><text x="1360" y="11555" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">total_time_ms</text><path d="M 1360,11583.416666666668 C 1420,11573.416666666668 1420,11613.416666666668 1360,11603.416666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1360" y1="11583.416666666668" x2="1360" y2="11583.416666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1360" y="11587.416666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">96</text><text x="1113" y="11628" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">更新会话历史</text><line x1="1350" y1="11657.416666666668" x2="876.5" y2="11657.416666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1350" y1="11657.416666666668" x2="1350" y2="11657.416666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1350" y="11661.416666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">97</text><text x="878" y="11672" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">add_message(user, query)</text><text x="878" y="11690" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">add_message(assistant, answer)</text><path d="M 877.5,11721.416666666668 C 937.5,11711.416666666668 937.5,11751.416666666668 877.5,11741.416666666668" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="877.5" y1="11721.416666666668" x2="877.5" y2="11721.416666666668" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="877.5" y="11725.416666666668" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">98</text><text x="878" y="11766" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">限制历史长度</text><text x="878" y="11783" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">max_history_length=20</text><text x="878" y="11801" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">保留最近消息</text><path d="M 877.5,11830.750000000002 C 937.5,11820.750000000002 937.5,11860.750000000002 877.5,11850.750000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="877.5" y1="11830.750000000002" x2="877.5" y2="11830.750000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="877.5" y="11834.750000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">99</text><text x="1112" y="11876" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">更新完成</text><line x1="877.5" y1="11904.750000000002" x2="1347" y2="11904.750000000002" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="877.5" y1="11904.750000000002" x2="877.5" y2="11904.750000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="877.5" y="11908.750000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">100</text><text x="873" y="11920" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">RAGResponse</text><text x="873" y="11937" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">{query, answer, context_chunks[],</text><text x="873" y="11955" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">generation_time_ms, retrieval_time_ms,</text><text x="873" y="11973" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">total_time_ms}</text><line x1="1350" y1="12003.500000000002" x2="396" y2="12003.500000000002" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="1350" y1="12003.500000000002" x2="1350" y2="12003.500000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1350" y="12007.500000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">101</text><text x="231" y="12019" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">JSON响应</text><text x="231" y="12036" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">{answer, references, metrics}</text><line x1="383" y1="12064.500000000002" x2="79" y2="12064.500000000002" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="383" y1="12064.500000000002" x2="383" y2="12064.500000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="383" y="12068.500000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">102</text><text x="1729" y="12157" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">upload_document(file)</text><line x1="76" y1="12187.500000000002" x2="3382" y2="12187.500000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="76" y1="12187.500000000002" x2="76" y2="12187.500000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="76" y="12191.500000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">103</text><text x="3391" y="12203" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">检查文件格式</text><text x="3391" y="12220" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">is_allowed_file()</text><path d="M 3391,12250.000000000002 C 3451,12240.000000000002 3451,12280.000000000002 3391,12270.000000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3391" y1="12250.000000000002" x2="3391" y2="12250.000000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3391" y="12254.000000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">104</text><text x="3391" y="12295" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">检查文件大小</text><text x="3391" y="12312" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">max_file_size</text><path d="M 3391,12342.500000000002 C 3451,12332.500000000002 3451,12372.500000000002 3391,12362.500000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3391" y1="12342.500000000002" x2="3391" y2="12342.500000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3391" y="12346.500000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">105</text><text x="3391" y="12388" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">save_upload_file()</text><text x="3391" y="12406" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">生成file_id</text><path d="M 3391,12435.000000000002 C 3451,12425.000000000002 3451,12465.000000000002 3391,12455.000000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3391" y1="12435.000000000002" x2="3391" y2="12435.000000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3391" y="12439.000000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">106</text><text x="3391" y="12480" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">DocumentParser.parse()</text><text x="3391" y="12497" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">解析文件内容</text><path d="M 3391,12527.500000000002 C 3451,12517.500000000002 3451,12557.500000000002 3391,12547.500000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3391" y1="12527.500000000002" x2="3391" y2="12527.500000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3391" y="12531.500000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">107</text><text x="3391" y="12688" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">chunker.chunk()</text><text x="3391" y="12705" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">RAGFlowChunker</text><path d="M 3391,12735.000000000002 C 3451,12725.000000000002 3451,12765.000000000002 3391,12755.000000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3391" y1="12735.000000000002" x2="3391" y2="12735.000000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3391" y="12739.000000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">108</text><text x="3396" y="12780" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_detect_policy_document()</text><text x="3396" y="12798" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">检测制度类文档</text><path d="M 3396,12827.500000000002 C 3456,12817.500000000002 3456,12857.500000000002 3396,12847.500000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3396" y1="12827.500000000002" x2="3396" y2="12827.500000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3396" y="12831.500000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">109</text><text x="3396" y="12918" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_financial_policy_chunking()</text><text x="3396" y="12936" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">章节结构分析</text><text x="3396" y="12953" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">表格保护</text><text x="3396" y="12970" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">层级路径构建</text><path d="M 3396,12998.750000000002 C 3456,12988.750000000002 3456,13028.750000000002 3396,13018.750000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3396" y1="12998.750000000002" x2="3396" y2="12998.750000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3396" y="13002.750000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">110</text><text x="3396" y="13089" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_naive_merge()</text><text x="3396" y="13107" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">按段落/句子切分</text><text x="3396" y="13124" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">token数量限制</text><path d="M 3396,13153.083333333336 C 3456,13143.083333333336 3456,13183.083333333336 3396,13173.083333333336" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3396" y1="13153.083333333336" x2="3396" y2="13153.083333333336" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3396" y="13157.083333333336" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">111</text><text x="3396" y="13238" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_create_chunk_infos()</text><text x="3396" y="13256" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">生成ChunkInfo对象</text><path d="M 3396,13285.583333333336 C 3456,13275.583333333336 3456,13315.583333333336 3396,13305.583333333336" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3396" y1="13285.583333333336" x2="3396" y2="13285.583333333336" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3396" y="13289.583333333336" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">112</text><text x="3396" y="13331" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_save_chunks_to_json()</text><text x="3396" y="13349" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">持久化切分结果</text><path d="M 3396,13378.083333333336 C 3456,13368.083333333336 3456,13408.083333333336 3396,13398.083333333336" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3396" y1="13378.083333333336" x2="3396" y2="13378.083333333336" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3396" y="13382.083333333336" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">113</text><text x="2684" y="13423" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">encode(chunks_content)</text><text x="2684" y="13441" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">批量编码</text><line x1="3381" y1="13470.583333333336" x2="1987" y2="13470.583333333336" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3381" y1="13470.583333333336" x2="3381" y2="13470.583333333336" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3381" y="13474.583333333336" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">114</text><text x="1988" y="13486" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">model.encode()</text><text x="1988" y="13503" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">BGE/SentenceTransformer/OpenAI</text><path d="M 1988,13534.583333333336 C 2048,13524.583333333336 2048,13564.583333333336 1988,13554.583333333336" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="1988" y1="13534.583333333336" x2="1988" y2="13534.583333333336" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1988" y="13538.583333333336" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">115</text><text x="2683" y="13580" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">embeddings[]</text><text x="2683" y="13597" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">shape: (n_chunks, dimension)</text><line x1="1988" y1="13628.583333333336" x2="3378" y2="13628.583333333336" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="1988" y1="13628.583333333336" x2="1988" y2="13628.583333333336" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="1988" y="13632.583333333336" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">116</text><text x="2791" y="13644" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">add_vectors(embeddings, metadata)</text><line x1="3381" y1="13674.583333333336" x2="2201" y2="13674.583333333336" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3381" y1="13674.583333333336" x2="3381" y2="13674.583333333336" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3381" y="13678.583333333336" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">117</text><text x="2202" y="13735" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">IndexHNSWFlat.add()</text><text x="2202" y="13752" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">批量添加(batch=1000)</text><text x="2202" y="13769" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">自动保存索引</text><path d="M 2202,13800.250000000002 C 2262,13790.250000000002 2262,13830.250000000002 2202,13820.250000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="2202" y1="13800.250000000002" x2="2202" y2="13800.250000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2202" y="13804.250000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">118</text><text x="2202" y="13890" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">client.insert()</text><text x="2202" y="13907" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">自动持久化</text><path d="M 2202,13937.750000000002 C 2262,13927.750000000002 2262,13967.750000000002 2202,13957.750000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="2202" y1="13937.750000000002" x2="2202" y2="13937.750000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2202" y="13941.750000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">119</text><text x="2790" y="14023" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">索引完成</text><line x1="2202" y1="14051.750000000002" x2="3378" y2="14051.750000000002" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="2202" y1="14051.750000000002" x2="2202" y2="14051.750000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="2202" y="14055.750000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">120</text><text x="3391" y="14067" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">更新文档状态</text><text x="3391" y="14084" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">status=PENDING→INDEXED</text><path d="M 3391,14112.750000000002 C 3451,14102.750000000002 3451,14142.750000000002 3391,14132.750000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3391" y1="14112.750000000002" x2="3391" y2="14112.750000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3391" y="14116.750000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">121</text><text x="3391" y="14158" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">_save_documents()</text><text x="3391" y="14176" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">持久化文档信息</text><path d="M 3391,14205.250000000002 C 3451,14195.250000000002 3451,14235.250000000002 3391,14225.250000000002" class="messageLine0" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="fill: none;"/><line x1="3391" y1="14205.250000000002" x2="3391" y2="14205.250000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3391" y="14209.250000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">122</text><text x="1730" y="14250" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">DocumentUploadResponse</text><text x="1730" y="14267" text-anchor="middle" dominant-baseline="middle" alignment-baseline="middle" class="messageText" dy="1em" style="font-size: 16px; font-weight: 400;">{id, name, status, chunk_count}</text><line x1="3381" y1="14297.750000000002" x2="79" y2="14297.750000000002" class="messageLine1" stroke-width="2" stroke="none" marker-end="url(#arrowhead)" style="stroke-dasharray: 3, 3; fill: none;"/><line x1="3381" y1="14297.750000000002" x2="3381" y2="14297.750000000002" stroke-width="0" marker-start="url(#sequencenumber)"/><text x="3381" y="14301.750000000002" font-family="sans-serif" font-size="12px" text-anchor="middle" class="sequenceNumber">123</text></svg>